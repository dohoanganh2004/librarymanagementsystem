@using ELibrary.WebApp.Models
@using ELibrary.WebApp.DTO.Response
@model PaginationModel<BookResponseDTO>

@if (Model.TotalPages > 1)
{
    <nav aria-label="Phân trang">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <!-- Thông tin hiển thị -->
            <div class="pagination-info">
                <small class="text-muted">
                    Hiển thị <strong>@Model.StartItem</strong> đến <strong>@Model.EndItem</strong> 
                    trong tổng số <strong>@Model.TotalItems</strong> kết quả
                </small>
            </div>

            <!-- Pagination controls -->
            <ul class="pagination pagination-sm mb-0">
                <!-- First page -->
                @if (Model.CurrentPage > 1)
                {
                    <li class="page-item">
                        <a class="page-link" href="@GetPageUrl(1)" aria-label="Trang đầu">
                            <i class="fas fa-angle-double-left"></i>
                        </a>
                    </li>
                }

                <!-- Previous page -->
                @if (Model.HasPreviousPage)
                {
                    <li class="page-item">
                        <a class="page-link" href="@GetPageUrl(Model.CurrentPage - 1)" aria-label="Trang trước">
                            <i class="fas fa-angle-left"></i>
                        </a>
                    </li>
                }

                <!-- Page numbers -->
                @foreach (var pageNumber in Model.GetPageNumbers())
                {
                    <li class="page-item @(pageNumber == Model.CurrentPage ? "active" : "")">
                        <a class="page-link" href="@GetPageUrl(pageNumber)">@pageNumber</a>
                    </li>
                }

                <!-- Next page -->
                @if (Model.HasNextPage)
                {
                    <li class="page-item">
                        <a class="page-link" href="@GetPageUrl(Model.CurrentPage + 1)" aria-label="Trang sau">
                            <i class="fas fa-angle-right"></i>
                        </a>
                    </li>
                }

                <!-- Last page -->
                @if (Model.CurrentPage < Model.TotalPages)
                {
                    <li class="page-item">
                        <a class="page-link" href="@GetPageUrl(Model.TotalPages)" aria-label="Trang cuối">
                            <i class="fas fa-angle-double-right"></i>
                        </a>
                    </li>
                }
            </ul>
        </div>

        <!-- Page size selector -->
        <div class="d-flex justify-content-end">
            <div class="form-group d-flex align-items-center">
                <label class="me-2 mb-0 small">Hiển thị:</label>
                <select class="form-select form-select-sm" style="width: auto;" onchange="changePageSize(this.value)">
                    @if (Model.PageSize == 5)
                    {
                        <option value="5" selected>5</option>
                    }
                    else
                    {
                        <option value="5">5</option>
                    }
                    
                    @if (Model.PageSize == 10)
                    {
                        <option value="10" selected>10</option>
                    }
                    else
                    {
                        <option value="10">10</option>
                    }
                    
                    @if (Model.PageSize == 20)
                    {
                        <option value="20" selected>20</option>
                    }
                    else
                    {
                        <option value="20">20</option>
                    }
                    
                    @if (Model.PageSize == 50)
                    {
                        <option value="50" selected>50</option>
                    }
                    else
                    {
                        <option value="50">50</option>
                    }
                </select>
                <span class="ms-2 small text-muted">/ trang</span>
            </div>
        </div>
    </nav>
}

@functions {
    private string GetPageUrl(int page)
    {
        var request = ViewContext.HttpContext.Request;
        var queryParams = new Dictionary<string, string>();
        
        // Giữ lại tất cả query parameters hiện tại
        foreach (var param in request.Query)
        {
            if (param.Key.ToLower() != "page")
            {
                queryParams[param.Key] = param.Value.ToString();
            }
        }
        
        // Thêm page parameter
        queryParams["page"] = page.ToString();
        
        // Tạo URL
        var queryString = string.Join("&", queryParams.Select(kvp => $"{kvp.Key}={Uri.EscapeDataString(kvp.Value)}"));
        var baseUrl = $"{request.Path}";
        
        return string.IsNullOrEmpty(queryString) ? baseUrl : $"{baseUrl}?{queryString}";
    }
}

<script>
    function changePageSize(pageSize) {
        var url = new URL(window.location);
        url.searchParams.set('pageSize', pageSize);
        url.searchParams.set('page', '1'); // Reset về trang 1 khi thay đổi page size
        window.location.href = url.toString();
    }
</script>